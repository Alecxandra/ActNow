<body class="blue-grey lighten-5">
<div class="row">
  <div class="col s3">
        <div class="row">
         <div class="card">
            <div class="card-image waves-effect waves-block waves-light"> <%= image_tag 'default_p.png'%>
             <div class="card-title">
               <%= cl_image_tag(@profile.photo, :width => 90, :height => 98, 
                           :crop => :fill, :gravity => :face,
                           :radius => 20, class:"responsive-img z-depth-3") %>
             </div>
             </div>
           
         <div class="card-content">
           <span class="card-title activator grey-text text-darken-4"> <strong><%= @profile.first_name %></strong>
                <i class="material-icons right">settings</i>
              </span>
             <p><%= current_user.email %><p>
         </div>
    <div class="card-reveal">
      <span class="card-title grey-text text-darken-4">Opciones<i class="material-icons right">close</i></span>
       <div class="collection">
         <%= link_to(edit_profile_path(@profile), { class: 'collection-item light-green-text text-accent-4' }) do %>
           <i class="material-icons">create</i> Editar perfil
         <% end %>
         
         <%= link_to(destroy_user_session_path, { method: :delete , class: 'collection-item light-green-text text-accent-4' }) do %>
         <i class="material-icons">keyboard_return</i>Cerrar sesion
         <% end %>
       
      </div>
    </div>
  </div>
        </div>    
        <div class="row">
           <div class="card">
               <div class="card-content">
                  <span class="card-title activator grey-text text-darken-4"> <strong>Informacion de contacto</strong></span>
             <p><i class=" material-icons light-green-text text-accent-4">email</i> <%= current_user.email %></p>
                  
             <p><i class="material-icons light-green-text text-accent-4">phone_android</i>  <%= @profile.phone_number %></p>    
         </div>
  </div>
        </div>
        <div class="row">
           <div class="card">
               <div class="card-content">
                  <span class="card-title activator grey-text text-darken-4"> <strong>Biografia</strong></span>
                 <p><%= @profile.about %></p>
                
         </div>
  </div>
        </div>
      </div>
  
  <div class="col s9">
      <div class="row">
               <div class="card col s10 offset-s1" style="overflow: visible;">
                  <%= form_for(@post, :html => { :multipart => true }) do |f| %>
                    <%= f.hidden_field :counter, :value => 0 %>
                    <%= f.hidden_field :state, :value =>"Sin resolver"%>
                      <div class="card-content">
                               <div class="row">
                                  <div class="input-field col s9">
                                    <i class="material-icons prefix">create</i>
                                    <%= f.text_field :title %>
                                    <label>Titulo</label>
                                  </div>
                                  <div class=" input-field col s3">
                                    
                                       <%= f.select(:importance, options_for_select(
                                          [   
                                            ["Prioridad",'', { 'disabled' => 'disabled', 'selected' => 'selected' }],
                                            ['Alta','Alta', {}],
                                            ['Media','Media', {}],
                                            ['Baja', 'Baja', {}] 
                                          ]
  )) %>
                                  </div>  
                               </div>
                               <div class="row">
                                   <div class="input-field">
                                       <i class="material-icons prefix">format_align_right</i>
                                      <%= f.text_area :description, class: "materialize-textarea" %>
                                      <label>Descripcion</label>
                                    </div> 
                                </div>
                               <div class="row">
                                 <%= f.fields_for :photos do |p| %>
                                       <%= p.hidden_field :url_cache %>
                                       <div class="file-field input-field">
                                          <div class="btn blue accent-3">
                                             <span>Foto</span>
                                             <%= p.file_field :url, multiple: true, 
                                             name: "photos[url][]",image_metadata: true %>
                                          </div>
                                          <div class="file-path-wrapper">
                                            <input class="file-path validate" type="text" placeholder="sube una o mas fotos">
                                          </div> 
                                       </div>  
                                 <% end %> 
                               
                               </div>
                               <div class="row">
                                  <div class="right">
                                   <button class="waves-effect waves-light btn light-green accent-4 right-align ">
                                     publicar
                                   </button>
                                 </div>  
                               </div>
                          </div>
                  <% end %>    
               </div>
          </div>
    <% @posts.order("created_at DESC").each do |post| %>
         <div class="row">
           <div class="card col s10 offset-s1">
              <div class="card-content">
                    <div class="row">
                       <div class="col s4 valign-wrapper">
                         <%= cl_image_tag(post.profile.photo, :width => 55, :height => 50, 
                           :crop => :fill, :gravity => :face,
                           :radius => 10, class:"responsive-img") %>
                      <span style="font-size:1em; margin:5px" class="valign">  <%=post.profile.first_name%></span>  
                       </div><!-- quien creo el post-->
                    </div><!-- El coso de arriba-->
                    <h1 class="card-title black-text center-align" style="margin:0px;">
                      <strong><%= post.title%></strong>
                    </h1>
                    <div class="row">
                    <p><%= post.description %></p>
                    </div>
                    <!-- Aqui van las fotos -->
                    <div class="row">
                       <!-- Modal Trigger -->
                        <a class="waves-effect waves-light btn modal-trigger" href="#modal1">Modal</a>
                       <!-- Modal Structure -->
                       <div id="modal1" class="modal">
                         <div class="modal-content">
                           <div class="jcarousel">
                             <ul>
                               <li> <%= image_tag("background1.jpg",width: "700px", height: "400px") %></li>
                               <li> <%= image_tag("Comayagua.jpg",width: "700px", height: "400px") %></li>
                             </ul>
                             <a href="#" class="jcarousel-prev" data-jcarouselcontrol="true">
                               <i class="material-icons">keyboard_arrow_left</i>
                             </a>
                             <a href="#" class="jcarousel-next" data-jcarouselcontrol="true"><i class="material-icons">keyboard_arrow_right</i></a>
                           </div>
                         </div>
                         
                         
                       </div>
                    </div>
                    <div class="row">
                      <span class="blue-grey-text text-lighten-3">
                        <%= post.created_at.strftime("%d-%b a las %d:%I %p")%>
                      </span>
                    </div>
                </div>
               <!-- Aqui van los comentarios -->
              <div class="card-reveal">
                <span class="card-title grey-text text-darken-4"><strong>Comentarios</strong><i class="material-icons right">close</i></span>
                  <!-- Crear comentario -->
                   <div class="">
                     <ul class="collection">
                       <%= form_for([post,@comment]) do |f| %>
                         <li class="collection-item avatar" style="padding-left:0px; ">
                          <div class="row">
                          <div class="col s1">
                           <%= cl_image_tag(@profile.photo, :width => 50, :height => 50, 
                           :crop => :fill, :gravity => :face,
                           :radius => 10 , class:"responsive-img left-align")%>
                          </div>
                          <div class="col s10">
                            <%= f.text_area :message, placeholder:"Escribe tu comentario" %>
                          </div> 
                          <div class="col s1">
                              <button class=" btn-flat secondary-content transparent" type="submit">
                                <i class=" material-icons light-green-text text-accent-4" style="font-size:30px">
                                  send
                                </i>
                              </button>
                          </div>
                        </div>
                         </li>
                       <% end %>
                       <!-- Listar comentarios-->
                       <% post.comments.each do |comment| %>
                        <li class="collection-item avatar " style="padding-left:0px">
                                <div class="row">
                                    <div class="col s1">
                                          <%= cl_image_tag(comment.profile.photo, :width => 50, :height => 50, 
                                     :crop => :fill, :gravity => :face,:radius => 10 , class:"responsive-img left-align")%>

                                    </div>
                                    <div class="col s11">
                                     <strong><%= comment.profile.first_name%></strong><br>
                                      <p class="text-black"><%= comment.message%></p><br>
                                      <span class="blue-grey-text text-lighten-3">
                                        <%= comment.created_at.strftime("%d-%b a las %d:%I %p")%>
                                      </span>
                                    </div>
                                </div>
                                <div class="row">
                                 <div class="s12">
                                    
                                 </div>
                                </div>
                          </li>
                       
                       <% end %> 
                     
                   </ul>
                   </div>
              </div>
              <!-- Aqui van otras acciones -->
              <div class="card-action">
                <div class="row">
                  <div class="col s3">
                    <% if post.importance == "Alta"%>
                      <i class="material-icons red-text text-darken-1">error</i>Prioridad alta  
                    <% elsif post.importance =="Media"%>
                      <i class="material-icons amber-text">warning</i>Prioridad Media
                    <% elsif post.importance == "Baja"%>
                      <i class="material-icons blue-text text-darken-2">error_outline</i>Prioridad Baja
                    <% end %>
                  </div>
                  <div class="col s3">
                    <%= link_to post_path(post) do %>
                      <i class="material-icons tooltipped green-text text-accent-4" data-position="top" data-delay="50" data-tooltip="I am tooltip">
                      location_on
                    </i>Lugar
                    <% end %>
                  </div>
                  <div class="col s2">
                   <i class="material-icons yellow-text text-darken-1">star</i><%=post.counter%>
                  </div>
                  <div class="col s2">
                   <i class="material-icons deep-orange-text">share</i>
                  </div> 
                  <div class="col s2">
                     <span class="card-title activator grey-text text-darken-4" style="font-size:14px">
                       <i class="material-icons light-blue-text text-accent-4">question_answer</i><%= post.comments.count %>
                     </span>
                  </div>
                  
                </div>
              </div>
           </div>
      </div>
       <% end %>
            
  </div>

   
</div>
</body>
